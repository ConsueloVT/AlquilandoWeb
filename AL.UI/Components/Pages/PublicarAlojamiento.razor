@page "/PublicarAlojamiento"
@rendermode InteractiveServer
@inject NavigationManager NavigationManager

@inject IServicioSesion ServicioSesion
@inject AlojamientoAlta AlojamientoAlta
@inject IAlojamientoRepositorio AlojamientoRepositorio
@inject IAlojamientoValidador AlojamientoValidador

<h3>Publicar Alojamiento</h3>

<form>
    <p>Nombre: <input placeholder="Nombre" @bind="_alojamiento.Nombre" class="form-control" required type="text"></p> 
    <p>Ciudad: <input placeholder="Ciudad" @bind="_alojamiento.Ciudad" class="form-control" required type="text"></p>
    <p>Direccion: <input placeholder="Direccion" @bind="_alojamiento.Direccion" class="form-control" required type="text"></p>
    <p>Precio: <input placeholder="Precio" @bind="_alojamiento.PrecioPorNoche" class="form-control" required type="number"></p>
    <p>Capacidad: <input placeholder="Capacidad Máxima" @bind="_alojamiento.CapacidadMaxima" class="form-control" required type="number"> </p>
    <p>Dormitorios: <input placeholder="Dormitorios" @bind="_alojamiento.CantidadDormitorios" class="form-control" required type="number"> </p>
    <p>Camas: <input placeholder="Camas" @bind="_alojamiento.CantidadCamas" class="form-control" required type="number"> </p>
    <p>Baños: <input placeholder="Baños" @bind="_alojamiento.CantidadBaños" class="form-control" required type="number"> </p>
    <p>Descripcion: <input placeholder="Descripcion" @bind="_alojamiento.Descripcion" class="form-control" required type="text"></p>
    <p>Servicios: <input placeholder="Descripcion" @bind="_alojamiento.Servicios" class="form-control" required type="text"></p>
 
</form> 

<div class="container">
    <button class="btn btn-primary" @onclick="RegistrarAlojamiento">Aceptar</button>
    <button @onclick="VolverMenu" class="btn btn-primary">Cancelar</button>
</div>

@if (!string.IsNullOrEmpty(ErrorMessage))
{
    <div class="alert alert-danger" role="alert">
        @ErrorMessage
    </div>
}

@if (!string.IsNullOrEmpty(SuccessMessage))
{
    <div class="alert alert-success" role="alert">
        @SuccessMessage
    </div>
}

@code {
    public RolUsuario rol => ServicioSesion.Rol;
    Alojamiento _alojamiento = new Alojamiento();
    string ErrorMessage { get; set; }=null!;
    string SuccessMessage {get;set;}=null!;

    private void RegistrarAlojamiento()
    {
        
        try{
            
            // Ejecutar el caso de uso para agregar un alojamiento
            AlojamientoAlta.Ejecutar(_alojamiento,rol);
            
            _alojamiento = new Alojamiento();
            ErrorMessage = "";
            SuccessMessage = "Alojamiento registrado con éxito";
        }
        catch(Exception msj){
            SuccessMessage = "";
            ErrorMessage = $"Error al publicar el alojamiento: {msj.Message}";
            Console.WriteLine($"Exception: {msj}");
        }

    }


    private void VolverMenu()
    {
             NavigationManager.NavigateTo("/CuentaAdministrador");  
    }
}
